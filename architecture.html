<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex"><meta name="built-on" content="2024-06-03T09:00:39.4700791"><title>Canvas Architecture | 4R Digital</title><script type="application/json" id="virtual-toc-data">[{"id":"about-canvas","level":0,"title":"About Canvas","anchor":"#about-canvas"},{"id":"architecture","level":0,"title":"Architecture","anchor":"#architecture"},{"id":"azure-architecture","level":0,"title":"Azure Architecture","anchor":"#azure-architecture"},{"id":"data-ingestion","level":0,"title":"Data Ingestion","anchor":"#data-ingestion"},{"id":"background-processing","level":0,"title":"Background Processing","anchor":"#background-processing"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.10.0-b259/app.css" rel="stylesheet"><meta name="msapplication-TileColor" content="#000000"><link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Canvas Architecture | 4R Digital"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="4R Digital Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="writerside-documentation/architecture.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="Canvas Architecture | 4R Digital"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "writerside-documentation/architecture.html#webpage",
    "url": "writerside-documentation/architecture.html",
    "name": "Canvas Architecture | 4R Digital",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "writerside-documentation/#website",
    "url": "writerside-documentation/",
    "name": "4R Digital Help"
}</script><!-- End Schema.org --></head><body data-id="Architecture" data-main-title="Canvas Architecture" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs="4RD-Team-Documentation.md|4RD Team Documentation"><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>4R Digital  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Architecture" id="Architecture.md">Canvas Architecture</h1><section class="chapter"><h2 id="about-canvas" data-toc="about-canvas">About Canvas</h2><p id="i8wrxd4_8016"><span class="control" id="i8wrxd4_8017">Canvas</span> is the name we use for our tech platform. We feel that we have identified a few core concepts that can support a number of use cases and we have built these concepts into Canvas. The concept, which you will hear described as <span class="control" id="i8wrxd4_8018">Activity Based Credit</span> from time to time by Nick our CEO, has three main components:</p><ol class="list _decimal" id="i8wrxd4_8019" type="1"><li class="list__item" id="i8wrxd4_8020"><p><span class="control" id="i8wrxd4_8021">Accounts</span> - supporting accounts, currencies, transactions and account entries - much like a standard bank account system.Seriv</p></li><li class="list__item" id="i8wrxd4_8022"><p><span class="control" id="i8wrxd4_8023">Entities</span> - supporting different types of entities, such as Suppliers, Customers, Supply Partners, Service Providers. Entities, can have 1 =&gt; many <span class="control" id="i8wrxd4_8024">Projects</span>.</p></li><li class="list__item" id="i8wrxd4_8025"><p><span class="control" id="i8wrxd4_8026">Activity</span> - Canvas records activity from a number of sources, which we aggregate into our accounting system. Activity is created by <span class="control" id="i8wrxd4_8027">Assets</span> and an asset can be anything from a Solar Water Pump, to an area of forestry.</p></li></ol><section class="chapter"><h3 id="canvas-use-cases" data-toc="canvas-use-cases">Canvas Use Cases</h3><p id="i8wrxd4_8028">We currently support two use cases on our Canvas platform:</p><ol class="list _decimal" id="i8wrxd4_8029" type="1"><li class="list__item" id="i8wrxd4_8030"><p><span class="control" id="i8wrxd4_8031">CaVEx</span> - Our carbon value exchange, which monitors and creates Carbon Credits from a variety of Assets, making these available to customers via our Customer facing application.</p></li><li class="list__item" id="i8wrxd4_8032"><p><span class="control" id="i8wrxd4_8033">Daylipa</span> - PAYG Solar Water Pumps, we monitor and control solar water pumps so that users can participate in a Pay as You Go contract.</p></li></ol></section><section class="chapter"><h3 id="protecting-canvas" data-toc="protecting-canvas">Protecting Canvas</h3><p id="i8wrxd4_8034">So far having Canvas as a shared platform has provided a great deal of benefit to us, but it is important that we protect it, keeping it a simple as possible and not over burden it by adding edge case functionality. Canvas needs to stick to the core concepts outlined above, and ancillary functionality should be built separately to keep our core code base clean. Edge case functionality can be added using satelite apps which can consume the back end services.</p></section></section><section class="chapter"><h2 id="architecture" data-toc="architecture">Architecture</h2><p id="i8wrxd4_8035">Canvas comprises a suite of Angular Apps, Web API's, internal GRPC services, Databases and background tasks. We have been using <span class="control" id="i8wrxd4_8036">C4</span> diagrams to describe our architecture as shown below:</p><section class="chapter"><h3 id="canvas-system-context-diagram" data-toc="canvas-system-context-diagram">Canvas System Context Diagram</h3><p id="i8wrxd4_8037">As you can see from the high level diagram below, the Canvas system is split into 3 main parts:</p><ol class="list _decimal" id="i8wrxd4_8038" type="1"><li class="list__item" id="i8wrxd4_8039"><p>Data Ingestion - responsible for receiving and storing incoming data from the IOT hubs(s) and project API(s). Within this application (and Azure building blocks), we are expecting to perform some aggregation, anomoly detection and audit. This will most likely be achieved using Azure tools such as <code class="code" id="i8wrxd4_8040">Stream Analytics</code>.</p></li><li class="list__item" id="i8wrxd4_8041"><p>Canvas Core - provides core functionality that can be used across multiple use cases, including Account/Transaction management, Activity recording, Asset and Customer management, Billing, Payments...</p></li><li class="list__item" id="i8wrxd4_8042"><p>Cavex Customer - this is only used in the <span class="control" id="i8wrxd4_8043">CaVEx</span> use case, this provides web and Mobile App functionality for <span class="control" id="i8wrxd4_8044">Project owners</span> and <span class="control" id="i8wrxd4_8045">Carbon Credit Buyers</span>.</p></li></ol><figure id="i8wrxd4_8046"><img alt="Cavex System Context" src="images/Cavex-System-Context.drawio.png" title="Cavex System Context" width="1319" height="1061"></figure></section><section class="chapter"><h3 id="canvas-container-diagram" data-toc="canvas-container-diagram">Canvas Container Diagram</h3><p id="i8wrxd4_8047">The container diagram shows the system with some more implementation detail included. The application landscape is made up of a number of Web apps (ASPNet Core BFF with Angular SPA), some <a href="backgroundprocessing.html" id="i8wrxd4_8048" data-tooltip="Start typing here...">background processors</a> and an internal <span class="control" id="i8wrxd4_8049">GRPC</span> services for cross app interactions. Some Azure services including:</p><ol class="list _decimal" id="i8wrxd4_8050" type="1"><li class="list__item" id="i8wrxd4_8051"><p>Azure SQL</p></li><li class="list__item" id="i8wrxd4_8052"><p>Blob Storadge</p></li><li class="list__item" id="i8wrxd4_8053"><p>Azure IOT Hub</p></li><li class="list__item" id="i8wrxd4_8054"><p><span class="emphasis" id="i8wrxd4_8055">Stream Analytics - work in progress</span></p></li></ol><p id="i8wrxd4_8056">We are also using <a href="https://auth0.com/" id="i8wrxd4_8057" data-external="true" rel="noopener noreferrer">Auth0</a> for Auth.</p><figure id="i8wrxd4_8058"><img alt="Container Context" src="images/Cavex-contianer-diagramc4.drawio.png" title="Container Context" width="1941" height="1611"></figure></section><section class="chapter"><h3 id="backend-core-logic-architecture" data-toc="backend-core-logic-architecture">Backend (CORE) Logic Architecture</h3><p id="i8wrxd4_8059">To help clarify the code structure of the CORE part of the Canvas application we have put together a component level diagram. We are using a <a href="https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html" id="i8wrxd4_8060" data-external="true" rel="noopener noreferrer">Clean Architecture Approach</a> alongside some <a href="https://code-maze.com/cqrs-mediatr-in-aspnet-core" id="i8wrxd4_8061" data-external="true" rel="noopener noreferrer">CQRS with Mediatr</a>. The diagram below shows the relationships between the various parts of the backend (CORE) code:</p><figure id="i8wrxd4_8062"><img alt="Canvas Component Diagram" src="images/CanvasComponentDiagram.png" title="Canvas Component Diagram" width="2046" height="1318"></figure></section></section><section class="chapter"><h2 id="azure-architecture" data-toc="azure-architecture">Azure Architecture</h2><p id="i8wrxd4_8063">The above sections describe how our application is organised in terms of code / components. Below is a diagram showing what this looks like in Azure. All of our c# and angular applications are deployed in a Kubernetes cluster, and we use various Azure services to support them. In particular we are using:</p><ol class="list _decimal" id="i8wrxd4_8064" type="1"><li class="list__item" id="i8wrxd4_8065"><p>Azure IOT Hub - for managing IOT devices and recording telemetry data.</p></li><li class="list__item" id="i8wrxd4_8066"><p>Azure SQL - for storing our business data</p></li><li class="list__item" id="i8wrxd4_8067"><p>Azure Blob Storage - for storing long term / cold data.</p></li><li class="list__item" id="i8wrxd4_8068"><p>Application Insights - for capturing monitoring / log info.</p></li><li class="list__item" id="i8wrxd4_8069"><p>Auth0 - for Authentication / Authorization</p></li><li class="list__item" id="i8wrxd4_8070"><p>Azure Key Vault - for storing secrets</p></li><li class="list__item" id="i8wrxd4_8071"><p>Defender for Cloud - for monitoring security across the Azure stack.</p></li></ol><p id="i8wrxd4_8072">The current application is shown below:</p><figure id="i8wrxd4_8073"><img alt="Azure Architecture Diagram" src="images/Canvas_Azure_Architecture.drawio.png" title="Azure Architecture Diagram" width="1252" height="721"></figure></section><section class="chapter"><h2 id="data-ingestion" data-toc="data-ingestion">Data Ingestion</h2><p id="i8wrxd4_8074">As you can see from above, we have separated out our data ingestion logic from the core application services. The data ingestion logic deals with all external interfaces, these currently include:</p><ol class="list _decimal" id="i8wrxd4_8075" type="1"><li class="list__item" id="i8wrxd4_8076"><p>Azure IOT Hub</p></li><li class="list__item" id="i8wrxd4_8077"><p>Burn API</p></li><li class="list__item" id="i8wrxd4_8078"><p>Canvas Project API (currently and Azure Fn)</p></li></ol><p id="i8wrxd4_8079">The diagram below shows the current Data Ingestion Architecture.</p><figure id="i8wrxd4_8080"><img alt="Data Ingestion Architecture" src="images/Background_Processor_Architecture.drawio.png" title="Data Ingestion Architecture" width="1242" height="601"></figure><section class="chapter"><h3 id="potential-enhancements-in-the-short-term" data-toc="potential-enhancements-in-the-short-term">Potential enhancements in the short term:</h3><ul class="list _bullet" id="i8wrxd4_8081"><li class="list__item" id="i8wrxd4_8082"><p>Azure Stream Analytics - for monitoring / anomoly detection of device telemetry.</p></li><li class="list__item" id="i8wrxd4_8083"><p>Cosmos DB - for short term storage of telemetry data</p></li></ul><p id="i8wrxd4_8084">We are currently evaluating these two and will make a decision on their inclusion shortly.</p></section></section><section class="chapter"><h2 id="background-processing" data-toc="background-processing">Background Processing</h2><p id="i8wrxd4_8085">Across the stack we are using <a href="https://www.hangfire.io/" id="i8wrxd4_8086" data-external="true" rel="noopener noreferrer">Hangfire</a> to facilitate the running of our background processes. For more info how we do our background processing, see: <a href="backgroundprocessing.html" id="i8wrxd4_8087" data-tooltip="Start typing here...">Canvas Background Processing</a>.</p></section><div class="last-modified">Last modified: 03 June 2024</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="4rd-team-documentation.html" class="navigation-links__prev">4RD Team Documentation</a><a href="backgroundprocessing.html" class="navigation-links__next">BackgroundProcessing</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.10.0-b259/app.js"></script></body></html>